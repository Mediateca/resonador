var config={apiKey:"AIzaSyDxRiTUgTD_KKfaeeY0HfUU4iZVcndq3mg",authDomain:"resonador-82846.firebaseapp.com",databaseURL:"https://resonador-82846.firebaseio.com",storageBucket:"resonador-82846.appspot.com",messagingSenderId:"237677222662"};firebase.initializeApp(config);var app=angular.module("app",["ngAnimate","ngAria","ngMaterial","ngMessages","ngRoute","ngSanitize","firebase","ngclipboard","material.components.expansionPanels","ngFileUpload"]);app.controller("main",[function(){console.log("main")}]),app.controller("contenido",["$firebaseAuth","$location",function($firebaseAuth,$location){console.log("contenido");var vista,ruta=$location.path(),rutaVista="views";switch(ruta){case"/":vista=rutaVista+ruta+"inicio.html";break;default:vista=rutaVista+ruta+".html"}var raiz=this,auth=$firebaseAuth();auth.$onAuthStateChanged(function(firebaseUser){firebaseUser?(raiz.rutaHeader="assets/html/header.html",raiz.rutaSidenav="assets/html/sidenav.html",raiz.rutaCuerpo=vista):(raiz.rutaHeader=null,raiz.rutaSidenav=null,"/perdiClave"!=ruta&&"/registro"!=ruta?raiz.rutaCuerpo=rutaVista+"/login.html":raiz.rutaCuerpo=rutaVista+ruta+".html")})}]),app.controller("header",["$firebaseAuth","$firebaseObject","$firebaseStorage","$firebaseArray","$rootScope",function($firebaseAuth,$firebaseObject,$firebaseStorage,$firebaseArray,$rootScope){console.log("header");var raiz=this;raiz.auth=$firebaseAuth();var usuarioAutenticado=raiz.auth.$getAuth(),listaUsuarios=$firebaseArray(firebase.database().ref("usuarios"));listaUsuarios.$loaded().then(function(ref){angular.forEach(listaUsuarios,function(valor,llave){valor.email==usuarioAutenticado.email&&(raiz.usuario=$firebaseObject(firebase.database().ref("usuarios/"+valor.$id)),raiz.usuario.$loaded().then(function(ref){var rutaAvatar=firebase.storage().ref("usuarios/avatar/"+raiz.usuario.$id+"."+raiz.usuario.avatar),ruta=$firebaseStorage(rutaAvatar);ruta.$getDownloadURL().then(function(url){raiz.rutaAvatar=url})}))})}),raiz.abreMenu=function($mdOpenMenu,ev){$mdOpenMenu(ev)},$rootScope.$on("userUpdate",function(ev,nuevosDatos){raiz.usuario=nuevosDatos[0],raiz.rutaAvatar=nuevosDatos[1]})}]),app.controller("sidenav",[function(){console.log("sidenav")}]),app.controller("login",["$firebaseAuth",function($firebaseAuth){console.log("login");var raiz=this,auth=$firebaseAuth();raiz.autenticar=function(){auth.$signInWithEmailAndPassword(raiz.usuario,raiz.clave).then(function(firebaseUser){console.log("Logueado como",firebaseUser.email)}).catch(function(error){console.log("Error",error)})}}]),app.controller("registro",[function(){console.log("registro");var raiz=this;raiz.codigoValidado=!1,raiz.validarCodigo=function(codigo){console.log("codigo",codigo),"pepe"==codigo&&(raiz.codigoValidado=!0)},raiz.enterCodigo=function(tecla,codigo){"Enter"==tecla.key&&raiz.validarCodigo(codigo)}}]),app.controller("editarPerfil",["$firebaseAuth","$firebaseObject","$firebaseStorage","$firebaseArray","Upload","$rootScope",function($firebaseAuth,$firebaseObject,$firebaseStorage,$firebaseArray,Upload,$rootScope){console.log("editarPerfil");var raiz=this;raiz.cargandoImagen=!1,raiz.auth=$firebaseAuth();var avatarStorage,usuarioAutenticado=raiz.auth.$getAuth(),listaUsuarios=$firebaseArray(firebase.database().ref("usuarios"));listaUsuarios.$loaded().then(function(ref){angular.forEach(listaUsuarios,function(valor,llave){valor.email==usuarioAutenticado.email&&(raiz.usuario=$firebaseObject(firebase.database().ref("usuarios/"+valor.$id)),raiz.usuario.$loaded().then(function(ref){var rutaAvatar=firebase.storage().ref("usuarios/avatar/"+raiz.usuario.$id+"."+raiz.usuario.avatar);avatarStorage=$firebaseStorage(rutaAvatar),avatarStorage.$getDownloadURL().then(function(url){raiz.rutaAvatar=url})}))})}),raiz.cambiarAvatar=function(avatar){if(raiz.cargandoImagen=!0,avatar){var extension;switch(avatar.type){case"image/jpeg":extension="jpg";break;case"image/png":extension="png";break;case"image/gif":extension="gif";break;default:extension="jpg"}var cargaAvatar;avatarStorage.$delete().then(function(){raiz.usuario.avatar=extension,avatarStorage=$firebaseStorage(firebase.storage().ref("usuarios/avatar/"+raiz.usuario.$id+"."+extension)),cargaAvatar=avatarStorage.$put(avatar,{contentType:avatar.type,usuario:avatar.email}),cargaAvatar.$progress(function(snapshot){raiz.porcentajeCarga=snapshot.bytesTransferred/snapshot.totalBytes*100}),cargaAvatar.$complete(function(snapshot){raiz.rutaAvatar=snapshot.downloadURL,raiz.cargandoImagen=!1,raiz.usuario.$save(),$rootScope.$emit("userUpdate",[raiz.usuario,raiz.rutaAvatar])})})}}}]);